<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Game Industry Data</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {% load bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
    
</head>
<body>

<ul class="nav nav-tabs">
    <li class="nav-item">
        <a href="#graph" class="nav-link active" data-bs-toggle="tab">Graphs</a>
    </li>
    <li class="nav-item">
        <a href="#trends" class="nav-link" data-bs-toggle="tab">Trends</a>
    </li>
    <li class="nav-item">
        <a href="#data" class="nav-link" data-bs-toggle="tab">Raw Data</a>
    </li>
    <li class="nav-item">
        <a href="#scraping" class="nav-link" data-bs-toggle="tab">Scraping</a>
    </li>
</ul>
<script>
$(function() {
    $('a[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
        localStorage.setItem('lastTab', $(this).attr('href'));
    });
    var lastTab = localStorage.getItem('lastTab');
    if (lastTab) {
        $('[href="' + lastTab + '"]').tab('show');
    }
});
</script>

<form class="row g-3 mx-5 mt-2" method="get">
    {% bootstrap_field offerFilter.form.titleF form_group_class="col-2" %}
    {% bootstrap_field offerFilter.form.employerF form_group_class="col-2" %}
    {% bootstrap_field offerFilter.form.locationF form_group_class="col-2" %}
    {% bootstrap_field offerFilter.form.experienceF form_group_class="col-2" %}
    {% bootstrap_field offerFilter.form.requirementsF form_group_class="col-2" %}
    <div class="col-12">
        {% bootstrap_button "Search" button_type="submit" button_class="btn-primary" %}
    </div>
</form>

<div class="tab-content">

    <div class="tab-pane fade m-5 show active" id="graph">
        <h3 class="d-flex justify-content-center">Programming Language Statistics</h3>
        <br><br><br>
        <div class="row d-flex justify-content-center">
        <!--Doughnut chart for programming languages-->
        <canvas id="myChart" width="500" height="500" class="mx-auto"></canvas>
        <script>
            const ctx = document.getElementById('myChart').getContext('2d');
            const myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Python', 'C#', 'C++', 'Java', 'SQL', 'Unity'],
                    datasets: [{
                        label: 'Programming languages',
                        data: {{langs}},
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false
                }
            });
        </script>
        <!--Bar Chart for programming languages-->
        <canvas id="barProgramming" width="500" height="500" class="mx-auto"></canvas>
        <script>
            const ctx1 = document.getElementById('barProgramming').getContext('2d');
            const barProgramming = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Python', 'C#', 'C++', 'Java', 'SQL', 'Unity'],
                    datasets: [{
                        label: 'Programming languages',
                        data: {{langs}},
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                       }
                    }
                }
            });
            </script>

            
        </div>
    </div>

    <div class="tab-pane fade m-5" id="trends">
        <h3 class="d-flex justify-content-center">Programming Language Trends</h3>
        <br><br><br>
        <!--Line Graph-->
        <canvas id="lineGraph" width="1200" height="600" class="mx-auto"></canvas>
        <script>
            const labels = [{% for t in timestamps %} "{{t}}", {% endfor %}]
            const data = {
                labels: labels,
                datasets: [
                    {
                        label: 'Python',
                        data: {{ trends.0 }},
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    },
                    {
                        label: 'C#',
                        data: {{ trends.1 }},
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    },
                    {
                        label: 'C++',
                        data: {{ trends.2 }},
                        borderColor: 'rgba(255, 206, 86, 1)',
                        backgroundColor: 'rgba(255, 206, 86, 0.2)',
                    },
                    {
                        label: 'Java',
                        data: {{ trends.3 }},
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    },
                    {
                        label: 'SQL',
                        data: {{ trends.4 }},
                        borderColor: 'rgba(153, 102, 255, 1)',
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    },
                    {
                        label: 'Unity',
                        data: {{ trends.5 }},
                        borderColor: 'rgba(255, 159, 64, 1)',
                        backgroundColor: 'rgba(255, 159, 64, 0.2)',
                    },

                ]
            };
            const lineCtx = document.getElementById('lineGraph').getContext('2d');
            const lineGraph = new Chart(lineCtx, {
                type: 'line',
                data: data,
                options: {
                    responsive: false,
                    maintainAspectRatio: false
                },
            });
        </script>
    </div>

    <div class="tab-pane fade m-5" id="data">
        <h3 class="d-flex justify-content-center">Search Raw Data</h3>
        <br/>

        <table class="table table-striped p-5 mt-3">
            <thead>
            <tr>
                <th>Job Title</th>
                <th>Company</th>
                <th>Location</th>
                <th>Experience</th>
                <th>Requirements</th>
            </tr>
            </thead>
            {% for offer in offers %}
            <tr>
                <td> {{ offer.title }} </td>
                <td> {{ offer.employer }} </td>
                <td> {{ offer.location }} </td>
                <td> {{ offer.experience }} </td>
                <td> {{ offer.requirements }} </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <div class="tab-pane fade m-5" id="scraping">
        <h3 class="d-flex justify-content-center">Manage Data Scraping</h3>
        <br/>
        <form method="GET" action="/gameindustry/scrape">
            <p>Warning: scraping may take a while (20-100 seconds, depending on internet connection)</p>
            {% bootstrap_button "Scrape" button_type="submit" button_class="btn-primary" %}
        </form>
    </div>

</div>

</body>
</html>
